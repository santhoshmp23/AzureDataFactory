{
	"name": "DF_Ingest_Turbines_data",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"linkedService": {
						"referenceName": "SqlDbCon",
						"type": "LinkedServiceReference"
					},
					"name": "SrcTurbinesData"
				}
			],
			"sinks": [
				{
					"linkedService": {
						"referenceName": "SQLConTSC",
						"type": "LinkedServiceReference"
					},
					"name": "SinkTurbinesData",
					"rejectedDataLinkedService": {
						"referenceName": "ls_Pipeline_logs",
						"type": "LinkedServiceReference"
					}
				}
			],
			"transformations": [],
			"scriptLines": [
				"source(output(",
				"          RegionName as string,",
				"          CountryName as string,",
				"          ScadaParkId as integer,",
				"          ScadaParkSourceId as string,",
				"          ScadaParkName as string,",
				"          TurbineOEM as string,",
				"          OEMTechnicalId as string,",
				"          TechnicalId as integer,",
				"          TurbineId as integer,",
				"          StationName as string,",
				"          TurbinePlatform as string,",
				"          TurbineModel as string,",
				"          TurbineType as string,",
				"          Timezone as string,",
				"          ControllerFamily as string,",
				"          ControllerTypeDesc as string,",
				"          Latitude as decimal(18,11),",
				"          Longitude as decimal(18,11),",
				"          IPAddress as integer,",
				"          SoftwareVersion as integer,",
				"          CreatedDate as date,",
				"          LastModifyDate as date",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     enableCdc: true,",
				"     mode: 'read',",
				"     skipInitialLoad: false,",
				"     waterMarkColumn: 'LastModifyDate',",
				"     format: 'query',",
				"     store: 'sqlserver',",
				"     query: (\"SELECT TurbineData.RegionName,TurbineData.CountryName,TurbineData.ScadaParkId,TurbineData.ScadaParkSourceId,TurbineData.ScadaParkName, TurbineData.TurbineOEM, TurbineData.OEMTechnicalId AS OEMTechnicalId, TurbineData.TechnicalId, TurbineData.TurbineId,  cast(StationData.StationName as varchar(max)) StationName, TurbineData.TurbinePlatform, TurbineData.TurbineModel,TurbineData.TurbineType, TurbineData.Timezone, TurbineData.ControllerFamily, TurbineData.ControllerTypeDesc, TurbineData.Latitude,TurbineData.Longitude,  NULL as IPAddress,NULL as SoftwareVersion ,  CAST(TurbineData.CreatedDate AS DATE) CreatedDate,CAST(TurbineData.LastModifyDate AS DATE) LastModifyDate FROM [dbo].[TurbineMasterData] TurbineData  LEFT JOIN [StationMaster] StationData ON TurbineData.TurbineId=StationData.IdStation\"),",
				"     isolationLevel: 'READ_UNCOMMITTED') ~> SrcTurbinesData",
				"SrcTurbinesData sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          ID as long,",
				"          RegionName as string,",
				"          CountryName as string,",
				"          SiteId as integer,",
				"          SiteSourceId as string,",
				"          SiteName as string,",
				"          TurbineOEM as string,",
				"          OEMTechnicalId as string,",
				"          TechnicalId as integer,",
				"          TurbineId as integer,",
				"          StationName as string,",
				"          TurbinePlatform as string,",
				"          TurbineModel as string,",
				"          TurbineType as string,",
				"          Timezone as string,",
				"          ControllerFamily as string,",
				"          ControllerTypeDesc as string,",
				"          Latitude as decimal(18,11),",
				"          Longitude as decimal(18,11),",
				"          IPAddress as string,",
				"          SoftwareVersion as string,",
				"          IsActive as boolean,",
				"          CreatedDate as timestamp,",
				"          LastModifyDate as timestamp,",
				"          WSOSiteId as string",
				"     ),",
				"     format: 'table',",
				"     store: 'sqlserver',",
				"     schemaName: 'dbo',",
				"     tableName: 'TurbineData',",
				"     insertable: true,",
				"     updateable: false,",
				"     deletable: false,",
				"     upsertable: false,",
				"     stagingSchemaName: '',",
				"     saveOrder: 1,",
				"     errorHandlingOption: 'stopOnFirstError',",
				"     outputRejectedData: true,",
				"     outputAssertFailedRows: true,",
				"     assertFailure_container: 'pipelinelog',",
				"     mapColumn(",
				"          RegionName,",
				"          CountryName,",
				"          SiteId = ScadaParkId,",
				"          SiteSourceId = ScadaParkSourceId,",
				"          SiteName = ScadaParkName,",
				"          TurbineOEM,",
				"          OEMTechnicalId,",
				"          TechnicalId,",
				"          TurbineId,",
				"          StationName,",
				"          TurbinePlatform,",
				"          TurbineModel,",
				"          TurbineType,",
				"          Timezone,",
				"          ControllerFamily,",
				"          ControllerTypeDesc,",
				"          Latitude,",
				"          Longitude,",
				"          IPAddress,",
				"          SoftwareVersion,",
				"          CreatedDate,",
				"          LastModifyDate",
				"     )) ~> SinkTurbinesData"
			]
		}
	}
}